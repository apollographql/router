---
title: Datadog exporter (via OTLP)
subtitle: Configure the Datadog exporter for metrics
description: Configure the Datadog exporter for metrics via OpenTelemetry Protocol (OTLP) in the Apollo GraphOS Router or Apollo Router Core.
---

Enable and configure the [OTLP exporter](./otlp) for metrics in the GraphOS Router or Apollo Router Core for use with [Datadog](https://www.datadoghq.com/).

For general tracing configuration, refer to [Router Metrics Configuration](./overview).

## Configuration 

To export metrics to Datadog, you must configure both the router to send traces to the Datadog agent and the Datadog agent to accept OpenTelemetry Protocol (OTLP) metrics.

### Router configuration

The router should set attributes that Datadog uses to organize its APM view and other UI:

- `otel.name`: span name that's fixed for Datadog
- `resource.name`: Datadog resource name that's displayed in traces
- `operation.name`: Datadog operation name that populates a dropdown menu in the Datadog service page

You should add these attributes to your `router.yaml` configuration file. The example below sets these attributes for the `router`, `supergraph`, and `subgraph` stages of the router's request lifecycle:

```title="router.yaml"
telemetry:
  instrumentation:
    spans:
      mode: spec_compliant
      router:
        attributes:
          otel.name: router
          operation.name: "router"
          resource.name:
            request_method: true

      supergraph:
        attributes:
          otel.name: supergraph
          operation.name: "supergraph"
          resource.name:
            operation_name: string

      subgraph:
        attributes:
          otel.name: subgraph
          operation.name: "subgraph"
          resource.name:
            subgraph_operation_name: string
```

### Datadog agent configuration

To configure the Datadog agent, add OTLP configuration (`otlp_config`) to your `datadog.yaml`. For example:

```yaml title="datadog.yaml"
otlp_config:
  receiver:
    protocols:
      grpc:
        endpoint: <dd-agent-ip>:4317
```

### Router configuration
To configure the router, enable the [OTLP exporter](./otlp#configuration) and set both `temporality: delta` and `endpoint: <datadog-agent-endpoint>`. For example: 

```yaml title="router.yaml"
telemetry:
  exporters:
    metrics:
      otlp:
        enabled: true
        # Temporality MUST be set to delta. Failure to do this will result in incorrect metrics.
        temporality: delta
        # Optional endpoint, either 'default' or a URL (Defaults to http://127.0.0.1:4317)
        endpoint: "${env.DATADOG_AGENT_HOST}:4317"
```

<Note>

**You must set `temporality: delta`**, otherwise the router generates incorrect metrics.

</Note>

For more details about Datadog configuration, see [Datadog's docs on Agent configuration](https://docs.datadoghq.com/opentelemetry/otlp_ingest_in_the_agent/?tab=host).

