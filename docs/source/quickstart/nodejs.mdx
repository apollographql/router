---
title: Local setup with nodejs subservices
sidebar_title: Local setup with Nodejs subservices
description: Set up the Apollo router, and run it against nodejs web services.
---

In this tutorial we will set up your environment so you can clone and build the router, as well as its subservices, and run the Apollo router against nodejs subservices.

If you would like to build and run the router, have a look at the [build and run example](build).
If you are looking for a less involved example, have a look at the [ðŸ³ Docker based example](docker) or the no dependencies [ðŸ§‘â€ðŸš€ Hello World! example](helloworld).

## Environment setup

### Prerequisites:

The router is written in rust, and the subservices we will use are written in nodejs. We need to install both in order to run this example:

- Nodejs: Follow the [install instructions](https://nodejs.org/en/download/) to install nodejs and npm.
- Rust: Head over to [the rustup website](https://rustup.rs/) to install rust.

## Git clone

âš ï¸ This project uses submodules. Make sure your submodules are initialized and up to date!

```sh
git clone https://github.com/apollographql/router.git
cd router
git submodule update --init --recursive
```

## Check for port availability

This project will need several available ports on your machine:

- 4001 to 4004: nodejs GraphQL subservices.
- 4000: The Apollo federation router.

## Setup and run the subservices

Let's go to the federation-demo directory, where the nodejs subservices sources are:

```sh
cd examples/nodejs/federation-demo
```

We can now install the nodejs dependencies by running:

```sh
npm install
```

And finally we can run the subservices:

```sh
npm run start-services
```

This command will run all of the microservices at once, respectively:

- [Accounts: http://localhost:4001](http://localhost:4001)
- [Reviews: http://localhost:4002](http://localhost:4002)
- [Products: http://localhost:4003](http://localhost:4003)
- [Inventory: http://localhost:4004](http://localhost:4004)

The output's last lines should look as follows:

```sh
[start-service-products] ðŸš€ Server ready at http://localhost:4003/
[start-service-accounts] ðŸš€ Server ready at http://localhost:4001/
[start-service-reviews] ðŸš€ Server ready at http://localhost:4002/
[start-service-inventory] ðŸš€ Server ready at http://localhost:4004/
```

## Running the Apollo federation router

In another terminal window, run the Apollo router by typing this command in the project's root directory:

```sh
cargo run --release -- -p ./examples/nodejs
```

Here is the expected output:

```sh
   Compiling router-bridge v0.1.0 (https://github.com/apollographql/federation.git)
   Compiling apollo-router-core v0.1.0-prealpha.3 (/Users/ignition/projects/apollo/router/crates/apollo-router-core)
   Compiling apollo-router v0.1.0-prealpha.3 (/Users/ignition/projects/apollo/router/crates/apollo-router)
    Finished dev [unoptimized + debuginfo] target(s) in 5.38s
     Running `target/debug/router -p ./examples/nodejs`
Nov 02 17:08:09.926  INFO router: Starting Apollo Router
Nov 02 17:08:10.279  INFO router: Listening on http://127.0.0.1:4000 ðŸš€
```

Go to http://127.0.0.1:4000 to open the [Apollo studio explorer](https://www.apollographql.com/docs/studio/explorer/). Inspect the graph, and run your first queries using the Apollo federation router!

## Troubleshooting ðŸ•µï¸

### I can perform queries in Apollo studio, but it doesn't work with my website / an other graphql client ðŸ¤”

If the client is browser based, it might be a CORS issue.

CORS can be configured in the `configuration.yaml` file:

Here is for example how to add localhost to the list of available origins:

```yaml
# examples/nodejs/configuration.yaml
server:
  listen: 127.0.0.1:4000
  cors:
    origins:
      - https://studio.apollographql.com
      - https://localhost
```

The exhaustive list of settings you can tweak is available in the [configuration](../configuration) section of the documentation.

Restart the Apollo router and try to perform the query again! ðŸš€

### Port 4000 isn't available on my machine ðŸ˜“

You can edit the listen address in the `configuration.yaml` file:

With this setup, the Apollo router will listen to port 11000

```yaml
# examples/nodejs/configuration.yaml
server:
  listen: 127.0.0.1:11000
```

The exhaustive list of settings you can tweak is available in the [configuration](../configuration) section of the documentation.

### One or several of the subservices ports don't suit me ðŸ˜“

If one of the ports mentionned above isn't available, that's okay!

Here is 3 steps example of how to change the accounts subservice's port, if port 4001 isn't available:

- 1. Head over to the subservices `index.js` files and update the port:

```javascript
// examples/nodejs/federation-demo/services/accounts/index.js, line 39

server.listen({ port: 10001 }).then(({ url }) => {
  console.log(`ðŸš€ Server ready at ${url}`);
});
```

The subservice will now listen to port 10001.

- 2. Update the `supergraph.graphql` url:

```graphql
// examples/nodejs/supergraph.graphql, line 22

enum join__Graph {
  ACCOUNTS @join__graph(name: "accounts" url: "http://localhost:10001/graphql")
  INVENTORY @join__graph(name: "inventory" url: "http://localhost:4004/graphql")
  PRODUCTS @join__graph(name: "products" url: "http://localhost:4003/graphql")
  REVIEWS @join__graph(name: "reviews" url: "http://localhost:4002/graphql")
}
```

- 3. Last but not least, update the Apollo routers `configuration.yaml` file:

```yaml
# examples/nodejs/configuration.yaml

subgraphs:
  accounts:
    routing_url: http://localhost:10001/graphql
```

Head back to the [Setup and run the subservices](#setup-and-run-the-subservices), and complete the steps from there.

### My issue hasn't been solved above

You can browse the current / closed issues in the [apollographql/router github repository](https://github.com/apollographql/router/issues). If your issue isn't mentionned here, please [open an issue](https://github.com/apollographql/router/issues/new/choose)!
