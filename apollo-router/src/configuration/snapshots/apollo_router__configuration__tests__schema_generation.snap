---
source: apollo-router/src/configuration/mod.rs
assertion_line: 445
expression: "&schema"
---
{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "title": "Configuration",
  "description": "The configuration for the router. Currently maintains a mapping of subgraphs.",
  "type": "object",
  "properties": {
    "forbid_mutations": {
      "type": "boolean"
    },
    "headers": {
      "type": "object",
      "properties": {
        "all": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "object",
                "required": [
                  "insert"
                ],
                "properties": {
                  "insert": {
                    "type": "object",
                    "required": [
                      "name",
                      "value"
                    ],
                    "properties": {
                      "name": {
                        "type": "string"
                      },
                      "value": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              },
              {
                "type": "object",
                "required": [
                  "remove"
                ],
                "properties": {
                  "remove": {
                    "oneOf": [
                      {
                        "type": "object",
                        "required": [
                          "named"
                        ],
                        "properties": {
                          "named": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "required": [
                          "matching"
                        ],
                        "properties": {
                          "matching": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": false
                      }
                    ]
                  }
                },
                "additionalProperties": false
              },
              {
                "type": "object",
                "required": [
                  "propagate"
                ],
                "properties": {
                  "propagate": {
                    "anyOf": [
                      {
                        "type": "object",
                        "required": [
                          "named"
                        ],
                        "properties": {
                          "default": {
                            "type": "string",
                            "nullable": true
                          },
                          "named": {
                            "type": "string"
                          },
                          "rename": {
                            "type": "string",
                            "nullable": true
                          }
                        },
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "required": [
                          "matching"
                        ],
                        "properties": {
                          "matching": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": false
                      }
                    ]
                  }
                },
                "additionalProperties": false
              }
            ]
          }
        },
        "subgraphs": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "oneOf": [
                {
                  "type": "object",
                  "required": [
                    "insert"
                  ],
                  "properties": {
                    "insert": {
                      "type": "object",
                      "required": [
                        "name",
                        "value"
                      ],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "value": {
                          "type": "string"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                },
                {
                  "type": "object",
                  "required": [
                    "remove"
                  ],
                  "properties": {
                    "remove": {
                      "oneOf": [
                        {
                          "type": "object",
                          "required": [
                            "named"
                          ],
                          "properties": {
                            "named": {
                              "type": "string"
                            }
                          },
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "required": [
                            "matching"
                          ],
                          "properties": {
                            "matching": {
                              "type": "string"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  },
                  "additionalProperties": false
                },
                {
                  "type": "object",
                  "required": [
                    "propagate"
                  ],
                  "properties": {
                    "propagate": {
                      "anyOf": [
                        {
                          "type": "object",
                          "required": [
                            "named"
                          ],
                          "properties": {
                            "default": {
                              "type": "string",
                              "nullable": true
                            },
                            "named": {
                              "type": "string"
                            },
                            "rename": {
                              "type": "string",
                              "nullable": true
                            }
                          },
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "required": [
                            "matching"
                          ],
                          "properties": {
                            "matching": {
                              "type": "string"
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  },
                  "additionalProperties": false
                }
              ]
            }
          }
        }
      },
      "additionalProperties": false
    },
    "override_subgraph_url": {
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "format": "uri"
      }
    },
    "plugins": {
      "description": "Plugin configuration",
      "default": null,
      "properties": {
        "experimental.rhai": {
          "type": "object",
          "required": [
            "filename"
          ],
          "properties": {
            "filename": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "experimental.traffic_shaping": {
          "type": "object",
          "properties": {
            "all": {
              "type": "object",
              "properties": {
                "dedup": {
                  "type": "boolean",
                  "nullable": true
                }
              },
              "nullable": true
            },
            "subgraphs": {
              "type": "object",
              "additionalProperties": {
                "type": "object",
                "properties": {
                  "dedup": {
                    "type": "boolean",
                    "nullable": true
                  }
                }
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "server": {
      "description": "Configuration options pertaining to the http server component.",
      "default": {
        "listen": "127.0.0.1:4000",
        "cors": null,
        "introspection": true
      },
      "type": "object",
      "properties": {
        "cors": {
          "description": "Cross origin request headers.",
          "default": null,
          "type": "object",
          "properties": {
            "allow_any_origin": {
              "description": "Set to true to allow any origin.\n\nDefaults to false Having this set to true is the only way to allow Origin: null.",
              "default": null,
              "type": "boolean",
              "nullable": true
            },
            "allow_credentials": {
              "description": "Set to true to add the `Access-Control-Allow-Credentials` header.",
              "default": null,
              "type": "boolean",
              "nullable": true
            },
            "allow_headers": {
              "description": "The headers to allow. Defaults to the required request header for Apollo Studio",
              "default": [
                "Content-Type"
              ],
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "expose_headers": {
              "description": "Which response headers should be made available to scripts running in the browser, in response to a cross-origin request.",
              "default": null,
              "type": "array",
              "items": {
                "type": "string"
              },
              "nullable": true
            },
            "methods": {
              "description": "Allowed request methods. Defaults to GET, POST, OPTIONS.",
              "default": [
                "GET",
                "POST",
                "OPTIONS"
              ],
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "origins": {
              "description": "The origin(s) to allow requests from. Defaults to `https://studio.apollographql.com/` for Apollo Studio.",
              "default": [],
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false,
          "nullable": true
        },
        "introspection": {
          "description": "introspection queries enabled by default",
          "default": true,
          "type": "boolean"
        },
        "listen": {
          "description": "The socket address and port to listen on Defaults to 127.0.0.1:4000",
          "default": "127.0.0.1:4000",
          "anyOf": [
            {
              "description": "Socket address.",
              "type": "string"
            },
            {
              "description": "Unix socket.",
              "type": "string"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "telemetry": {
      "type": "object",
      "properties": {
        "metrics": {
          "type": "object",
          "required": [
            "exporter"
          ],
          "properties": {
            "exporter": {
              "oneOf": [
                {
                  "type": "object",
                  "required": [
                    "prometheus"
                  ],
                  "properties": {
                    "prometheus": {
                      "type": "object",
                      "required": [
                        "endpoint"
                      ],
                      "properties": {
                        "endpoint": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "additionalProperties": false
                },
                {
                  "type": "object",
                  "required": [
                    "otlp"
                  ],
                  "properties": {
                    "otlp": {
                      "type": "object",
                      "oneOf": [
                        {
                          "type": "object",
                          "required": [
                            "grpc"
                          ],
                          "properties": {
                            "grpc": {
                              "type": "object",
                              "properties": {
                                "endpoint": {
                                  "default": null,
                                  "type": "string",
                                  "format": "uri",
                                  "nullable": true
                                },
                                "metadata": {
                                  "default": null,
                                  "type": "object",
                                  "additionalProperties": true,
                                  "nullable": true
                                },
                                "protocol": {
                                  "default": null,
                                  "type": "string",
                                  "enum": [
                                    "Grpc",
                                    "HttpBinary"
                                  ],
                                  "nullable": true
                                },
                                "timeout": {
                                  "type": "integer",
                                  "format": "uint64",
                                  "minimum": 0.0,
                                  "nullable": true
                                },
                                "tls_config": {
                                  "type": "object",
                                  "properties": {
                                    "ca": {
                                      "oneOf": [
                                        {
                                          "type": "object",
                                          "required": [
                                            "env"
                                          ],
                                          "properties": {
                                            "env": {
                                              "type": "string"
                                            }
                                          },
                                          "additionalProperties": false
                                        },
                                        {
                                          "type": "object",
                                          "required": [
                                            "file"
                                          ],
                                          "properties": {
                                            "file": {
                                              "type": "string"
                                            }
                                          },
                                          "additionalProperties": false
                                        }
                                      ],
                                      "nullable": true
                                    },
                                    "cert": {
                                      "oneOf": [
                                        {
                                          "type": "object",
                                          "required": [
                                            "env"
                                          ],
                                          "properties": {
                                            "env": {
                                              "type": "string"
                                            }
                                          },
                                          "additionalProperties": false
                                        },
                                        {
                                          "type": "object",
                                          "required": [
                                            "file"
                                          ],
                                          "properties": {
                                            "file": {
                                              "type": "string"
                                            }
                                          },
                                          "additionalProperties": false
                                        }
                                      ],
                                      "nullable": true
                                    },
                                    "domain_name": {
                                      "type": "string",
                                      "nullable": true
                                    },
                                    "key": {
                                      "oneOf": [
                                        {
                                          "type": "object",
                                          "required": [
                                            "env"
                                          ],
                                          "properties": {
                                            "env": {
                                              "type": "string"
                                            }
                                          },
                                          "additionalProperties": false
                                        },
                                        {
                                          "type": "object",
                                          "required": [
                                            "file"
                                          ],
                                          "properties": {
                                            "file": {
                                              "type": "string"
                                            }
                                          },
                                          "additionalProperties": false
                                        }
                                      ],
                                      "nullable": true
                                    }
                                  },
                                  "additionalProperties": false,
                                  "nullable": true
                                }
                              },
                              "additionalProperties": false,
                              "nullable": true
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  },
                  "additionalProperties": false
                }
              ]
            }
          },
          "nullable": true
        },
        "opentelemetry": {
          "oneOf": [
            {
              "type": "object",
              "required": [
                "jaeger"
              ],
              "properties": {
                "jaeger": {
                  "type": "object",
                  "properties": {
                    "endpoint": {
                      "oneOf": [
                        {
                          "type": "object",
                          "required": [
                            "agent"
                          ],
                          "properties": {
                            "agent": {
                              "type": "string"
                            }
                          },
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "required": [
                            "collector"
                          ],
                          "properties": {
                            "collector": {
                              "type": "string",
                              "format": "uri"
                            }
                          },
                          "additionalProperties": false
                        }
                      ],
                      "nullable": true
                    },
                    "service_name": {
                      "default": "router",
                      "type": "string"
                    },
                    "trace_config": {
                      "type": "object",
                      "properties": {
                        "attributes": {
                          "type": "object",
                          "additionalProperties": {
                            "anyOf": [
                              {
                                "description": "bool values",
                                "type": "boolean"
                              },
                              {
                                "description": "i64 values",
                                "type": "integer",
                                "format": "int64"
                              },
                              {
                                "description": "f64 values",
                                "type": "number",
                                "format": "double"
                              },
                              {
                                "description": "String values",
                                "type": "string"
                              },
                              {
                                "description": "Array of homogeneous values",
                                "anyOf": [
                                  {
                                    "description": "Array of bools",
                                    "type": "array",
                                    "items": {
                                      "type": "boolean"
                                    }
                                  },
                                  {
                                    "description": "Array of integers",
                                    "type": "array",
                                    "items": {
                                      "type": "integer",
                                      "format": "int64"
                                    }
                                  },
                                  {
                                    "description": "Array of floats",
                                    "type": "array",
                                    "items": {
                                      "type": "number",
                                      "format": "double"
                                    }
                                  },
                                  {
                                    "description": "Array of strings",
                                    "type": "array",
                                    "items": {
                                      "type": "string"
                                    }
                                  }
                                ]
                              }
                            ]
                          },
                          "nullable": true
                        },
                        "max_attributes_per_event": {
                          "type": "integer",
                          "format": "uint32",
                          "minimum": 0.0,
                          "nullable": true
                        },
                        "max_attributes_per_link": {
                          "type": "integer",
                          "format": "uint32",
                          "minimum": 0.0,
                          "nullable": true
                        },
                        "max_attributes_per_span": {
                          "type": "integer",
                          "format": "uint32",
                          "minimum": 0.0,
                          "nullable": true
                        },
                        "max_events_per_span": {
                          "type": "integer",
                          "format": "uint32",
                          "minimum": 0.0,
                          "nullable": true
                        },
                        "max_links_per_span": {
                          "type": "integer",
                          "format": "uint32",
                          "minimum": 0.0,
                          "nullable": true
                        },
                        "sampler": {
                          "default": null,
                          "oneOf": [
                            {
                              "type": "string",
                              "enum": [
                                "AlwaysOn",
                                "AlwaysOff"
                              ]
                            },
                            {
                              "description": "Respects the parent span's sampling decision or delegates a delegate sampler for root spans. Not supported via yaml config Sample a given fraction of traces. Fractions >= 1 will always sample. If the parent span is sampled, then it's child spans will automatically be sampled. Fractions < 0 are treated as zero, but spans may still be sampled if their parent is.",
                              "type": "object",
                              "required": [
                                "TraceIdRatioBased"
                              ],
                              "properties": {
                                "TraceIdRatioBased": {
                                  "type": "number",
                                  "format": "double"
                                }
                              },
                              "additionalProperties": false
                            }
                          ],
                          "nullable": true
                        }
                      },
                      "additionalProperties": false,
                      "nullable": true
                    }
                  },
                  "additionalProperties": false,
                  "nullable": true
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "required": [
                "otlp"
              ],
              "properties": {
                "otlp": {
                  "type": "object",
                  "properties": {
                    "tracing": {
                      "type": "object",
                      "required": [
                        "exporter"
                      ],
                      "properties": {
                        "exporter": {
                          "oneOf": [
                            {
                              "type": "object",
                              "required": [
                                "grpc"
                              ],
                              "properties": {
                                "grpc": {
                                  "type": "object",
                                  "properties": {
                                    "endpoint": {
                                      "default": null,
                                      "type": "string",
                                      "format": "uri",
                                      "nullable": true
                                    },
                                    "metadata": {
                                      "default": null,
                                      "type": "object",
                                      "additionalProperties": true,
                                      "nullable": true
                                    },
                                    "protocol": {
                                      "default": null,
                                      "type": "string",
                                      "enum": [
                                        "Grpc",
                                        "HttpBinary"
                                      ],
                                      "nullable": true
                                    },
                                    "timeout": {
                                      "type": "integer",
                                      "format": "uint64",
                                      "minimum": 0.0,
                                      "nullable": true
                                    },
                                    "tls_config": {
                                      "type": "object",
                                      "properties": {
                                        "ca": {
                                          "oneOf": [
                                            {
                                              "type": "object",
                                              "required": [
                                                "env"
                                              ],
                                              "properties": {
                                                "env": {
                                                  "type": "string"
                                                }
                                              },
                                              "additionalProperties": false
                                            },
                                            {
                                              "type": "object",
                                              "required": [
                                                "file"
                                              ],
                                              "properties": {
                                                "file": {
                                                  "type": "string"
                                                }
                                              },
                                              "additionalProperties": false
                                            }
                                          ],
                                          "nullable": true
                                        },
                                        "cert": {
                                          "oneOf": [
                                            {
                                              "type": "object",
                                              "required": [
                                                "env"
                                              ],
                                              "properties": {
                                                "env": {
                                                  "type": "string"
                                                }
                                              },
                                              "additionalProperties": false
                                            },
                                            {
                                              "type": "object",
                                              "required": [
                                                "file"
                                              ],
                                              "properties": {
                                                "file": {
                                                  "type": "string"
                                                }
                                              },
                                              "additionalProperties": false
                                            }
                                          ],
                                          "nullable": true
                                        },
                                        "domain_name": {
                                          "type": "string",
                                          "nullable": true
                                        },
                                        "key": {
                                          "oneOf": [
                                            {
                                              "type": "object",
                                              "required": [
                                                "env"
                                              ],
                                              "properties": {
                                                "env": {
                                                  "type": "string"
                                                }
                                              },
                                              "additionalProperties": false
                                            },
                                            {
                                              "type": "object",
                                              "required": [
                                                "file"
                                              ],
                                              "properties": {
                                                "file": {
                                                  "type": "string"
                                                }
                                              },
                                              "additionalProperties": false
                                            }
                                          ],
                                          "nullable": true
                                        }
                                      },
                                      "additionalProperties": false,
                                      "nullable": true
                                    }
                                  },
                                  "additionalProperties": false,
                                  "nullable": true
                                }
                              },
                              "additionalProperties": false
                            }
                          ]
                        },
                        "trace_config": {
                          "type": "object",
                          "properties": {
                            "attributes": {
                              "type": "object",
                              "additionalProperties": {
                                "anyOf": [
                                  {
                                    "description": "bool values",
                                    "type": "boolean"
                                  },
                                  {
                                    "description": "i64 values",
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  {
                                    "description": "f64 values",
                                    "type": "number",
                                    "format": "double"
                                  },
                                  {
                                    "description": "String values",
                                    "type": "string"
                                  },
                                  {
                                    "description": "Array of homogeneous values",
                                    "anyOf": [
                                      {
                                        "description": "Array of bools",
                                        "type": "array",
                                        "items": {
                                          "type": "boolean"
                                        }
                                      },
                                      {
                                        "description": "Array of integers",
                                        "type": "array",
                                        "items": {
                                          "type": "integer",
                                          "format": "int64"
                                        }
                                      },
                                      {
                                        "description": "Array of floats",
                                        "type": "array",
                                        "items": {
                                          "type": "number",
                                          "format": "double"
                                        }
                                      },
                                      {
                                        "description": "Array of strings",
                                        "type": "array",
                                        "items": {
                                          "type": "string"
                                        }
                                      }
                                    ]
                                  }
                                ]
                              },
                              "nullable": true
                            },
                            "max_attributes_per_event": {
                              "type": "integer",
                              "format": "uint32",
                              "minimum": 0.0,
                              "nullable": true
                            },
                            "max_attributes_per_link": {
                              "type": "integer",
                              "format": "uint32",
                              "minimum": 0.0,
                              "nullable": true
                            },
                            "max_attributes_per_span": {
                              "type": "integer",
                              "format": "uint32",
                              "minimum": 0.0,
                              "nullable": true
                            },
                            "max_events_per_span": {
                              "type": "integer",
                              "format": "uint32",
                              "minimum": 0.0,
                              "nullable": true
                            },
                            "max_links_per_span": {
                              "type": "integer",
                              "format": "uint32",
                              "minimum": 0.0,
                              "nullable": true
                            },
                            "sampler": {
                              "default": null,
                              "oneOf": [
                                {
                                  "type": "string",
                                  "enum": [
                                    "AlwaysOn",
                                    "AlwaysOff"
                                  ]
                                },
                                {
                                  "description": "Respects the parent span's sampling decision or delegates a delegate sampler for root spans. Not supported via yaml config Sample a given fraction of traces. Fractions >= 1 will always sample. If the parent span is sampled, then it's child spans will automatically be sampled. Fractions < 0 are treated as zero, but spans may still be sampled if their parent is.",
                                  "type": "object",
                                  "required": [
                                    "TraceIdRatioBased"
                                  ],
                                  "properties": {
                                    "TraceIdRatioBased": {
                                      "type": "number",
                                      "format": "double"
                                    }
                                  },
                                  "additionalProperties": false
                                }
                              ],
                              "nullable": true
                            }
                          },
                          "additionalProperties": false,
                          "nullable": true
                        }
                      },
                      "additionalProperties": false,
                      "nullable": true
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            }
          ],
          "nullable": true
        },
        "opentracing": {
          "type": "object",
          "required": [
            "format"
          ],
          "properties": {
            "format": {
              "type": "string",
              "enum": [
                "jaeger",
                "zipkin_b3"
              ]
            }
          },
          "nullable": true
        },
        "spaceport": {
          "type": "object",
          "required": [
            "external"
          ],
          "properties": {
            "collector": {
              "default": "https://127.0.0.1:50051",
              "type": "string"
            },
            "external": {
              "type": "boolean"
            },
            "listener": {
              "default": "127.0.0.1:50051",
              "type": "string"
            }
          },
          "additionalProperties": false,
          "nullable": true
        }
      },
      "additionalProperties": false
    },
    "test.always_fails_to_start": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "type": "string"
        }
      }
    },
    "test.always_fails_to_start_and_stop": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "type": "string"
        }
      }
    },
    "test.always_fails_to_stop": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "type": "string"
        }
      }
    },
    "test.always_starts_and_stops": {
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "type": "string"
        }
      }
    }
  }
}
