---
title: Subgraph entity caching for the Apollo Router
subtitle: Redis-backed caching for entities
description: Subgraph entity caching for Apollo Router with GraphOS Enterprise. Cache and reuse individual entities across queries
---

<EnterpriseFeature />

The Apollo Router can cache, in Redis, data returned by subgraph queries, split per entity. This means that the same client query performed by different clients, with different arguments, will be able to share data from subgraph responses.

## Prerequisites

To use this feature:

- You must have a Redis cluster (or single instance) that your router instances can communicate with.
- You must have a [GraphOS Enterprise plan](https://www.apollographql.com/pricing/) and [connect your router to GraphOS](./overview/#environment-variables).

## How it works

As an example, we might have a query requesting:
- the cart of the current user
- for each product in the cart:
    - its description and price
    - its availability in inventory

If we were caching the entire client response, we would have to store it with a short time to live, because the cart data can change often, and inventory has to be up to date. That cache cannot be shared between users, because the cart is personal. We would also duplicate a lot of data between responses, because a lot of the products might appear in multiple carts.

With entity caching, we are able to:
- store each product's description and price separately, with a large TTL
- for each query, some of the products might already be in cache, so we will send smaller queries to the subgraph, or even no query at all
- share the product cache between all users
- cache the cart per user, with a small amount of data
- cache inventory data with a low TTL or even not cache it at all

## Configuration

It is setup as follows:

```yaml title="router.yaml"
experimental_entity_cache:
    redis: #highlight-line
        urls: ["redis://..."] #highlight-line
        timeout: 5ms # Optional, by default: 2ms
        ttl: 24h # Optional, by default no expiration
experimental_entity_cache:
  redis:
    urls: ["redis://..."]
    timeout: 5ms # Optional, by default: 2ms
    ttl: 24h # Optional, by default no expiration
  enabled: true
  subgraphs:
    accounts:
      enabled: false # disable for a specific subgraph
    reviews:
      ttl: 120s # overrides the global TTL
```

The `redis` section follows the same convention as in [distributed caching](./distributed-caching).

## Time to live

We can configure a global TTL for all the entries in Redis.

The Apollo Router will also honor the `Cache-Control` header returned with the subgraph response, and generate a `Cache-Control` header for the client response by aggregating the TTL information from all the response parts.