---
title: Sending headers to subgraphs
sidebar_title: Header propagation
description: Configuring the HTTP headers which are sent to subgraphs
---



You can customize which HTTP headers the Apollo Router includes in its requests to your subgraphs. Transformations can be specified on all or per-subgraph basis in your [YAML configuration file](#configuration-file).

```yaml{3-12}
# ...other configuration...

headers:
  all:
    - propagate:
        matching: ^upstream-header-.*
    - remove:
        named: "x-legacy-account-id"
  subgraphs:
    products:
    - insert:
        name: "router-subgraph-name"
        value: "products"

```

The following transformations are possible:

### `propagate`

Enables you to selectively propagate headers that were included in the client's request to the router.

You can specify which headers to propagate based on a matching [regex pattern](https://docs.rs/regex/latest/regex/):

```yaml
- propagate:
    matching: .*
```
> **Note:** The Router _never_ propagates so-called [hop-by-hop headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers#hop-by-hop_headers), such as `Content-Length` when propagating by pattern.


You can also provide a static string with the `named` option. These `named` configurations have additional flexibility, because they support the following options:

- `default`: A value to set if _no_ value was sent by the client
- `rename`: Renames the header's key to the provided value

```yaml
- propagate:
      named: "x-user-id"
      default: "abc123"
      rename: "account-id"
```

### `remove`

Enables you to selectively remove headers that were included in the client's request to the router. This option can match either a static string or a [regular expression](https://docs.rs/regex/latest/regex/).

> **Note:** The Router _never_ propagates so-called [hop-by-hop headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers#hop-by-hop_headers), such as `Content-Length`.

```yaml
# Do not send this subgraph the "Cookie" header.
- remove:
    named: "Cookie"
- remove:
    # Remove headers that include the legacy 'x-' prefix.
    matching: ^x-.*$
```

### `insert`

Enables you to add custom headers to requests going to a specific subgraph. These headers are always static strings that originate in the router, instead of originating in the client.

```yaml
- insert:
    name: "sent-from-our-apollo-router"
    value: "indeed"
```

### Example

Here's a complete example showing all the possible configuration options in use.

```yaml
headers:
  # All subgraph configuration.
  all:
  # Propagate matching headers.
  - propagate:
      matching: ^upstream-header-.*
  # Propagate matching headers.
  - propagate:
      named: "some-header"
      default: "default-value"
      rename: "destination-header"
  # Remove the "x-legacy-account-id" header.
  - remove:
      named: "x-legacy-account-id"
  # Remove matching headers.
  - remove:
      matching: ^x-deprecated-.*
  # Insert the 'my-company' header.
  - insert:
      name: "my-company"
      value: "acme"
  # Subgraph-specific configuration.
  subgraphs:
    products:
      # Calls to the products subgraph will have the "router-subgraph-name" header set to `products`.
      - insert:
          name: "router-subgraph-name"
          value: "products"
      accounts:
        # Calls to the accounts subgraph will have the "router-subgraph-name" header set to `accounts`.
        - insert:
            name: "router-subgraph-name"
            value: "accounts"
```
