---
title: Local setup with docker-compose
sidebar_title: Local setup with Docker
description: Set up the Apollo router, and run it against a docker-compose based example.
---

In this tutorial we will set up your environment so you can clone, build and run the Apollo router, as well as the `docker-compose` suite of subgraph services, as well as a [Jaeger tracing](https://www.jaegertracing.io/) collector.

If you are looking for a less involved example, have a look at the no dependencies [üßë‚ÄçüöÄ Hello World! example](helloworld).
If you would don't want to install docker locally, or want to edit the subraphs nodejs code, have a look at the the [Nodejs based example](nodejs).

## Environment setup

### Prerequisites:

The router is written in rust, and the subservices we will use are embedded within a Docker container. We need to install both in order to run this example:

- Docker: Follow the [get started](https://www.docker.com/get-started) guide to install docker and docker-compose.
- Rust: Head over to [the rustup website](https://rustup.rs/) to install rust.

## Git clone

‚ö†Ô∏è This project uses submodules. Make sure your submodules are initialized and up to date!

```sh
git clone https://github.com/apollographql/router.git
cd router
git submodule update --init --recursive
```

## Check for port availability

This project will need several available ports on your machine:

- 4001 to 4004: nodejs GraphQL subservices.
- 6831, 6832, 16686 and 14268: a [Jaeger tracing](https://www.jaegertracing.io/) node that will collect logs and spans from the gateway, the Apollo federation router, and the subservices. The traces are available at http://localhost:16686
- 4000: The Apollo federation router.

## Setup and run the dependencies

Let's go to the docker-compose directory...

```sh
cd examples/docker-compose
```

...and set up the docker environment

```sh
docker-compose up -d
```

Setting up all of the services may take a while, but subsequent `docker-compose up`s won't take long.

The expected output looks as follows:

```sh
[+] Running 2/0
 ‚†ø Container router-jaeger-1    Running                                       0.0s
 ‚†ø Container router-services-1  Running                                       0.0s
```

If you would like to have a look at the logs generated by the containers, you can run the following command:

```sh
docker-compose logs -f
```

A more exhaustive introduction to `docker-compose` can be found in the official [docker-compose CLI documentation](https://docs.docker.com/compose/reference/).

## Running the Apollo federation router

Run the Apollo router by typing this command in the project's root directory:

```sh
cargo run --release -- -p ./examples/docker-compose
```

Here is the expected output:

```sh
   Compiling router-bridge v0.1.0 (https://github.com/apollographql/federation.git)
   Compiling apollo-router-core v0.1.0-prealpha.3 (/Users/ignition/projects/apollo/router/crates/apollo-router-core)
   Compiling apollo-router v0.1.0-prealpha.3 (/Users/ignition/projects/apollo/router/crates/apollo-router)
    Finished dev [unoptimized + debuginfo] target(s) in 5.38s
     Running `target/debug/router -p ./examples/docker-compose`
Nov 02 17:08:09.926  INFO router: Starting Apollo Router
Nov 02 17:08:10.279  INFO router: Listening on http://127.0.0.1:4000 üöÄ
```

Go to http://127.0.0.1:4000 to open the [Apollo studio explorer](https://www.apollographql.com/docs/studio/explorer/). Inspect the graph, and run your first queries using the Apollo federation router!

## Troubleshooting üïµÔ∏è

### I can perform queries in Apollo studio, but it doesn't work with my website / an other graphql client ü§î

If the client is browser based, it might be a CORS issue.

CORS can be configured in the `configuration.yaml` file:

Here is for example how to add localhost to the list of available origins:

```yaml
# examples/nodejs/configuration.yaml
server:
  listen: 127.0.0.1:4000
  cors:
    origins:
      - https://studio.apollographql.com
      - https://localhost
```

The exhaustive list of settings you can tweak is available in the [configuration](../configuration) section of the documentation.

Restart the Apollo router and try to perform the query again! üöÄ

### Port 4000 isn't available on my machine üòì

You can edit the listen address in the `configuration.yaml` file:

With this setup, the Apollo router will listen to port 11000

```yaml
# examples/nodejs/configuration.yaml
server:
  listen: 127.0.0.1:11000
```

The exhaustive list of settings you can tweak is available in the [configuration](../configuration) section of the documentation.

### One or several of the subservices ports don't suit me üòì

If one of the ports mentionned above isn't available, that's okay!

Here is 3 steps example of how to change the accounts subservice's port, if port 4001 isn't available:

- 1. Head over to the docker-compose.yml file, and edit the port on the host side:

```yml
// examples/docker-compose/docker-compose.yml, line 7
version: "3.9"
services:
  services:
    build: ../nodejs/
    ports:
      - 10001:4001 # map host port 10001 to container port 4001
      - 4002:4002
      - 4003:4003
      - 4004:4004
```

docker-compose will now map port 10001 on our host to port 4001 within the container.

- 2. Update the `supergraph.graphql` url:

```graphql
// examples/nodejs/supergraph.graphql, line 22

enum join__Graph {
  ACCOUNTS @join__graph(name: "accounts" url: "http://localhost:10001/graphql")
  INVENTORY @join__graph(name: "inventory" url: "http://localhost:4004/graphql")
  PRODUCTS @join__graph(name: "products" url: "http://localhost:4003/graphql")
  REVIEWS @join__graph(name: "reviews" url: "http://localhost:4002/graphql")
}
```

- 3. Last but not least, update the Apollo routers `configuration.yaml` file:

```yaml
# examples/nodejs/configuration.yaml

subgraphs:
  accounts:
    routing_url: http://localhost:10001/graphql
```

Head back to the [Setup and run the subservices](#setup-and-run-the-subservices), and complete the steps from there.

### My issue hasn't been solved above

You can browse the current / closed issues in the [apollographql/router github repository](https://github.com/apollographql/router/issues). If your issue isn't mentionned here, please [open an issue](https://github.com/apollographql/router/issues/new/choose)!
